{
  "version": 4,
  "terraform_version": "1.14.5",
  "serial": 30,
  "lineage": "29986bfa-b877-e3f9-6271-a843b3f428bc",
  "outputs": {
    "build_log_info": {
      "value": "Azure Portal \u003e Image Templates \u003e aib-w365-dev-ai-1-0-2 \u003e Logs (or run: Get-AzImageBuilderTemplate -Name 'aib-w365-dev-ai-1-0-2' -ResourceGroupName 'rg-w365-images' | Select-Object -ExpandProperty LastRunStatus)",
      "type": "string"
    },
    "gallery_id": {
      "value": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Compute/galleries/acgW365Dev",
      "type": "string"
    },
    "image_definition_id": {
      "value": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Compute/galleries/acgW365Dev/images/W365-W11-25H2-ENU",
      "type": "string"
    },
    "image_template_name": {
      "value": "aib-w365-dev-ai-1-0-2",
      "type": "string"
    },
    "managed_identity_id": {
      "value": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-aib-w365-dev",
      "type": "string"
    },
    "managed_identity_principal_id": {
      "value": "8e8bff56-b7ab-4d1d-a6fb-4d82ed2983fa",
      "type": "string"
    },
    "next_steps": {
      "value": "\n══════════════════════════════════════════════════════════════════\nIMAGE BUILD COMPLETE — NEXT STEPS\n══════════════════════════════════════════════════════════════════\n\n1. VERIFY IMAGE VERSION\n   Get-AzGalleryImageVersion `\n     -ResourceGroupName \"rg-w365-images\" `\n     -GalleryName \"acgW365Dev\" `\n     -GalleryImageDefinitionName \"W365-W11-25H2-ENU\" |\n     Format-Table Name, ProvisioningState, PublishingProfile\n\n2. TEAR DOWN BUILD INFRASTRUCTURE (cost optimization)\n   Remove the AIB template and build resources (gallery is protected):\n   .\\scripts\\Teardown-BuildResources.ps1\n\n   NOTE: Do NOT run 'terraform destroy' — the gallery and image\n   definition have prevent_destroy = true and destroy will fail.\n\n3. IMPORT INTO WINDOWS 365 (Portal)\n   Intune \u003e Devices \u003e Windows 365 \u003e Custom images \u003e Add\n   \u003e Azure Compute Gallery\n   \u003e Select: acgW365Dev / W365-W11-25H2-ENU / 1.0.2\n\n4. CREATE/UPDATE PROVISIONING POLICY\n   Assign the imported image to a provisioning policy\n   targeting your developer security group.\n\n5. USER CONFIGURATION (post-login)\n   Each user manages their own ANTHROPIC_API_KEY:\n   - Set as user environment variable, or\n   - Configure via OpenClaw settings\n\n6. PROMOTE (when validated)\n   Set exclude_from_latest = false and re-apply:\n   terraform apply -var='exclude_from_latest=false'\n\n══════════════════════════════════════════════════════════════════\n",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "managed",
      "type": "azurerm_resource_group",
      "name": "images",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images",
            "location": "eastus2",
            "managed_by": "",
            "name": "rg-w365-images",
            "tags": {
              "cost_center": "Engineering",
              "iac": "Terraform",
              "managed_by": "PlatformEngineering",
              "purpose": "DeveloperImages",
              "workload": "Windows365"
            },
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "name": "rg-w365-images",
            "subscription_id": "7a713a84-2144-4ea1-8e85-9c63111bd995"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo1NDAwMDAwMDAwMDAwLCJkZWxldGUiOjU0MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjo1NDAwMDAwMDAwMDAwfX0="
        }
      ]
    },
    {
      "module": "module.gallery",
      "mode": "managed",
      "type": "azurerm_shared_image",
      "name": "this",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "accelerated_network_support_enabled": true,
            "architecture": "x64",
            "confidential_vm_enabled": false,
            "confidential_vm_supported": false,
            "description": "",
            "disk_controller_type_nvme_enabled": true,
            "disk_types_not_allowed": [],
            "end_of_life_date": null,
            "eula": "",
            "gallery_name": "acgW365Dev",
            "hibernation_enabled": true,
            "hyper_v_generation": "V2",
            "id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Compute/galleries/acgW365Dev/images/W365-W11-25H2-ENU",
            "identifier": [
              {
                "offer": "W365-W11-25H2-ENU",
                "publisher": "BigHatGroupInc",
                "sku": "W11-25H2-ENT-Dev"
              }
            ],
            "location": "eastus2",
            "max_recommended_memory_in_gb": 0,
            "max_recommended_vcpu_count": 0,
            "min_recommended_memory_in_gb": 0,
            "min_recommended_vcpu_count": 0,
            "name": "W365-W11-25H2-ENU",
            "os_type": "Windows",
            "privacy_statement_uri": "",
            "purchase_plan": [],
            "release_note_uri": "",
            "resource_group_name": "rg-w365-images",
            "specialized": false,
            "tags": {
              "cost_center": "Engineering",
              "iac": "Terraform",
              "managed_by": "PlatformEngineering",
              "purpose": "DeveloperImages",
              "workload": "Windows365"
            },
            "timeouts": null,
            "trusted_launch_enabled": true,
            "trusted_launch_supported": false
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "gallery_name": "acgW365Dev",
            "name": "W365-W11-25H2-ENU",
            "resource_group_name": "rg-w365-images",
            "subscription_id": "7a713a84-2144-4ea1-8e85-9c63111bd995"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_resource_group.images",
            "module.gallery.azurerm_shared_image_gallery.this"
          ]
        }
      ]
    },
    {
      "module": "module.gallery",
      "mode": "managed",
      "type": "azurerm_shared_image_gallery",
      "name": "this",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "",
            "id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Compute/galleries/acgW365Dev",
            "location": "eastus2",
            "name": "acgW365Dev",
            "resource_group_name": "rg-w365-images",
            "sharing": [],
            "tags": {
              "cost_center": "Engineering",
              "iac": "Terraform",
              "managed_by": "PlatformEngineering",
              "purpose": "DeveloperImages",
              "workload": "Windows365"
            },
            "timeouts": null,
            "unique_name": "7a713a84-2144-4ea1-8e85-9c63111bd995-ACGW365DEV"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "name": "acgW365Dev",
            "resource_group_name": "rg-w365-images",
            "subscription_id": "7a713a84-2144-4ea1-8e85-9c63111bd995"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_resource_group.images"
          ]
        }
      ]
    },
    {
      "module": "module.identity",
      "mode": "managed",
      "type": "azurerm_role_assignment",
      "name": "aib_gallery_contributor",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "condition": "",
            "condition_version": "",
            "delegated_managed_identity_resource_id": "",
            "description": "",
            "id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Compute/galleries/acgW365Dev/providers/Microsoft.Authorization/roleAssignments/08833943-1b53-a5cd-898e-558a1bdae76b",
            "name": "08833943-1b53-a5cd-898e-558a1bdae76b",
            "principal_id": "8e8bff56-b7ab-4d1d-a6fb-4d82ed2983fa",
            "principal_type": "ServicePrincipal",
            "role_definition_id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/providers/Microsoft.Authorization/roleDefinitions/85a2d0d9-2eba-4c9c-b355-11c2cc0788ab",
            "role_definition_name": "Compute Gallery Artifacts Publisher",
            "scope": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Compute/galleries/acgW365Dev",
            "skip_service_principal_aad_check": true,
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMH19",
          "dependencies": [
            "azurerm_resource_group.images",
            "module.gallery.azurerm_shared_image_gallery.this",
            "module.identity.azurerm_user_assigned_identity.aib"
          ]
        }
      ]
    },
    {
      "module": "module.identity",
      "mode": "managed",
      "type": "azurerm_role_assignment",
      "name": "aib_identity_operator",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "condition": "",
            "condition_version": "",
            "delegated_managed_identity_resource_id": "",
            "description": "",
            "id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Authorization/roleAssignments/db154f76-96f9-bc9f-f512-dfddddf7a161",
            "name": "db154f76-96f9-bc9f-f512-dfddddf7a161",
            "principal_id": "8e8bff56-b7ab-4d1d-a6fb-4d82ed2983fa",
            "principal_type": "ServicePrincipal",
            "role_definition_id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830",
            "role_definition_name": "Managed Identity Operator",
            "scope": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images",
            "skip_service_principal_aad_check": null,
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "azurerm_resource_group.images",
            "module.identity.azurerm_user_assigned_identity.aib"
          ]
        }
      ]
    },
    {
      "module": "module.identity",
      "mode": "managed",
      "type": "azurerm_role_assignment",
      "name": "aib_network_contributor",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "condition": "",
            "condition_version": "",
            "delegated_managed_identity_resource_id": "",
            "description": "",
            "id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Authorization/roleAssignments/dda7dae9-8c13-4307-0e18-c07dc64ebad9",
            "name": "dda7dae9-8c13-4307-0e18-c07dc64ebad9",
            "principal_id": "8e8bff56-b7ab-4d1d-a6fb-4d82ed2983fa",
            "principal_type": "ServicePrincipal",
            "role_definition_id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7",
            "role_definition_name": "Network Contributor",
            "scope": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images",
            "skip_service_principal_aad_check": null,
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "azurerm_resource_group.images",
            "module.identity.azurerm_user_assigned_identity.aib"
          ]
        }
      ]
    },
    {
      "module": "module.identity",
      "mode": "managed",
      "type": "azurerm_role_assignment",
      "name": "aib_vm_contributor",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "condition": "",
            "condition_version": "",
            "delegated_managed_identity_resource_id": "",
            "description": "",
            "id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.Authorization/roleAssignments/995031af-14db-b3ed-e6f5-4f384a6a63da",
            "name": "995031af-14db-b3ed-e6f5-4f384a6a63da",
            "principal_id": "8e8bff56-b7ab-4d1d-a6fb-4d82ed2983fa",
            "principal_type": "ServicePrincipal",
            "role_definition_id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/providers/Microsoft.Authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c",
            "role_definition_name": "Virtual Machine Contributor",
            "scope": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images",
            "skip_service_principal_aad_check": null,
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "azurerm_resource_group.images",
            "module.identity.azurerm_user_assigned_identity.aib"
          ]
        }
      ]
    },
    {
      "module": "module.identity",
      "mode": "managed",
      "type": "azurerm_user_assigned_identity",
      "name": "aib",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "client_id": "9e46c2d2-a830-41f3-940d-fbaf1efec158",
            "id": "/subscriptions/7a713a84-2144-4ea1-8e85-9c63111bd995/resourceGroups/rg-w365-images/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-aib-w365-dev",
            "isolation_scope": "",
            "location": "eastus2",
            "name": "id-aib-w365-dev",
            "principal_id": "8e8bff56-b7ab-4d1d-a6fb-4d82ed2983fa",
            "resource_group_name": "rg-w365-images",
            "tags": {
              "cost_center": "Engineering",
              "iac": "Terraform",
              "managed_by": "PlatformEngineering",
              "purpose": "DeveloperImages",
              "workload": "Windows365"
            },
            "tenant_id": "5a01497e-1bcb-4711-b6e6-d24f4ab00393",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "azurerm_resource_group.images"
          ]
        }
      ]
    },
    {
      "module": "module.image_builder",
      "mode": "managed",
      "type": "time_static",
      "name": "build_time",
      "provider": "provider[\"registry.terraform.io/hashicorp/time\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "day": 26,
            "hour": 21,
            "id": "2026-02-26T21:02:13Z",
            "minute": 2,
            "month": 2,
            "rfc3339": "2026-02-26T21:02:13Z",
            "second": 13,
            "triggers": null,
            "unix": 1772139733,
            "year": 2026
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    }
  ],
  "check_results": [
    {
      "object_kind": "var",
      "config_addr": "var.node_version",
      "status": "pass",
      "objects": [
        {
          "object_addr": "var.node_version",
          "status": "pass"
        }
      ]
    },
    {
      "object_kind": "var",
      "config_addr": "var.image_version",
      "status": "pass",
      "objects": [
        {
          "object_addr": "var.image_version",
          "status": "pass"
        }
      ]
    },
    {
      "object_kind": "var",
      "config_addr": "var.source_image_version",
      "status": "pass",
      "objects": [
        {
          "object_addr": "var.source_image_version",
          "status": "pass"
        }
      ]
    },
    {
      "object_kind": "var",
      "config_addr": "var.gallery_name",
      "status": "pass",
      "objects": [
        {
          "object_addr": "var.gallery_name",
          "status": "pass"
        }
      ]
    }
  ]
}
